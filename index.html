<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Clone</title>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <!-- CryptoJS voor encryptie -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #4ecdc4;
            --danger: #ff6b6b;
            --warning: #ffd166;
            --info: #118ab2;
            --dark: #2d3748;
            --light: #f8f9fa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            transition: all 0.3s ease;
            padding: 10px;
        }

        .hidden {
            display: none !important;
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        /* Update Mode */
        .update-mode {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            color: white;
            font-size: 2rem;
            text-align: center;
            flex-direction: column;
        }

        .update-mode h1 {
            margin-bottom: 20px;
            font-size: 3rem;
        }

        .update-mode p {
            font-size: 1.2rem;
            opacity: 0.8;
        }

        /* Troll Effects */
        .troll-mode {
            animation: rainbow 1s infinite;
        }

        @keyframes rainbow {
            0% { background: #ff0000; }
            16% { background: #ff8000; }
            33% { background: #ffff00; }
            50% { background: #00ff00; }
            66% { background: #0000ff; }
            83% { background: #8000ff; }
            100% { background: #ff0080; }
        }

        .spin {
            animation: spin 0.5s linear infinite;
        }

        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        .shake {
            animation: shake 0.5s linear infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .bounce {
            animation: bounce 0.5s ease infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        /* Login/Register Container */
        .login-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            padding: 30px 25px;
            width: 100%;
            max-width: 400px;
            backdrop-filter: blur(10px);
            margin: 20px auto;
        }

        .login-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .login-header h1 {
            color: var(--dark);
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .login-header p {
            color: #666;
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 18px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: var(--dark);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .input-with-icon {
            position: relative;
        }

        .form-control {
            width: 100%;
            padding: 14px 45px 14px 15px;
            border: 2px solid #e1e1e1;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fff;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
            padding: 8px;
            font-size: 1rem;
        }

        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: var(--dark);
        }

        .btn-troll {
            background: linear-gradient(45deg, #ff0000, #00ff00, #0000ff);
            color: white;
            animation: trollButton 2s infinite;
        }

        @keyframes trollButton {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .error-message {
            background: var(--danger);
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            display: none;
            font-size: 0.9rem;
        }

        .success-message {
            background: var(--success);
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            display: none;
            font-size: 0.9rem;
        }

        .switch-form {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e1e1e1;
        }

        .switch-form a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        .switch-form a:hover {
            text-decoration: underline;
        }

        /* Main App */
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        /* Header */
        .app-header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            padding: 1rem 1.5rem;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e1e1e1;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 1.3rem;
            color: var(--dark);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: var(--light);
        }

        .change-password-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .change-password-btn:hover {
            background: var(--light);
        }

        .admin-panel-btn {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .admin-panel-btn:hover {
            background: var(--light);
        }

        .update-mode-btn {
            background: none;
            border: none;
            color: var(--warning);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .update-mode-btn:hover {
            background: var(--light);
        }

        .troll-mode-btn {
            background: none;
            border: none;
            color: #ff00ff;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .troll-mode-btn:hover {
            background: var(--light);
        }

        /* Mobile Menu Button */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--dark);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .menu-toggle:hover {
            background: var(--light);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 0;
            display: flex;
            flex-direction: column;
        }

        /* Messages System */
        .messages-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 0;
            height: calc(100vh - 80px);
        }

        /* Mobile Menu */
        .mobile-menu-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 100;
        }

        .mobile-menu-overlay.active {
            display: block;
        }

        .users-list {
            background: white;
            border-right: 1px solid #e1e1e1;
            display: flex;
            flex-direction: column;
            height: 100%;
            transition: transform 0.3s ease;
        }

        .users-header {
            padding: 20px;
            border-bottom: 1px solid #e1e1e1;
            background: var(--light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-menu {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--dark);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .close-menu:hover {
            background: var(--light);
        }

        .users-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .chat-type-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 8px;
            border: 2px solid transparent;
            position: relative;
        }

        .chat-type-item:hover, .chat-type-item.active {
            background: var(--light);
        }

        .chat-type-item.global-chat {
            border-color: var(--info);
            background: rgba(17, 138, 178, 0.1);
        }

        .chat-type-item.global-chat.active {
            background: var(--info);
            color: white;
        }

        .chat-type-item.global-chat.active .chat-type-icon {
            color: white;
        }

        .chat-type-item.private-chat {
            border-color: var(--success);
            background: rgba(78, 205, 196, 0.1);
        }

        .chat-type-item.private-chat.active {
            background: var(--success);
            color: white;
        }

        .chat-type-item.private-chat.active .chat-type-icon {
            color: white;
        }

        .chat-type-icon {
            font-size: 1.2rem;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .global-chat .chat-type-icon {
            background: var(--info);
        }

        .private-chat .chat-type-icon {
            background: var(--success);
        }

        .chat-window {
            background: white;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid #e1e1e1;
            background: var(--light);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .global-chat-header {
            background: var(--info);
            color: white;
        }

        .global-chat-header .chat-type-icon {
            background: white;
            color: var(--info);
        }

        .private-chat-header {
            background: var(--success);
            color: white;
        }

        .private-chat-header .chat-type-icon {
            background: white;
            color: var(--success);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 85%;
            position: relative;
            word-wrap: break-word;
        }

        .message.sent {
            background: var(--primary);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 6px;
        }

        .message.received {
            background: white;
            color: var(--dark);
            border-bottom-left-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .message.global {
            background: var(--info);
            color: white;
            max-width: 90%;
            margin-left: 0;
            margin-right: 0;
        }

        .message.private {
            background: var(--success);
            color: white;
            max-width: 90%;
            margin-left: 0;
            margin-right: 0;
        }

        .message-time {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 4px;
            text-align: right;
        }

        .message.received .message-time {
            text-align: left;
        }

        .message.global .message-time {
            text-align: left;
        }

        .message.private .message-time {
            text-align: left;
        }

        .message-sender {
            font-weight: 600;
            font-size: 0.8rem;
            margin-bottom: 4px;
            opacity: 0.9;
        }

        .message-status {
            font-size: 0.6rem;
            margin-top: 2px;
            opacity: 0.7;
            text-align: right;
        }

        .message-actions {
            display: flex;
            gap: 8px;
            margin-top: 5px;
            opacity: 0.7;
        }

        .message-actions button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .chat-input-container {
            padding: 20px;
            border-top: 1px solid #e1e1e1;
            background: white;
        }

        .chat-input {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .message-input {
            flex: 1;
            padding: 14px 16px;
            border: 2px solid #e1e1e1;
            border-radius: 25px;
            font-size: 1rem;
            resize: none;
            max-height: 120px;
            min-height: 50px;
        }

        .message-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .global-chat .message-input:focus {
            border-color: var(--info);
        }

        .private-chat .message-input:focus {
            border-color: var(--success);
        }

        .send-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .global-chat .send-btn {
            background: var(--info);
        }

        .private-chat .send-btn {
            background: var(--success);
        }

        .send-btn:hover:not(:disabled) {
            background: var(--secondary);
            transform: scale(1.05);
        }

        .global-chat .send-btn:hover:not(:disabled) {
            background: #0a7a9c;
        }

        .private-chat .send-btn:hover:not(:disabled) {
            background: #3db5a8;
        }

        .send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            position: absolute;
            right: 0;
            top: 0;
        }

        /* Admin Panel */
        .admin-panel-content {
            max-height: 400px;
            overflow-y: auto;
        }

        .admin-user-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .admin-user-table th, .admin-user-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .admin-user-table th {
            background-color: var(--light);
            font-weight: 600;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--light);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: #666;
        }

        /* Troll Panel */
        .troll-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .messages-container {
                grid-template-columns: 1fr;
            }

            .users-list {
                position: fixed;
                top: 0;
                left: 0;
                width: 280px;
                height: 100%;
                z-index: 200;
                transform: translateX(-100%);
            }

            .users-list.active {
                transform: translateX(0);
            }

            .menu-toggle {
                display: block;
            }

            .close-menu {
                display: block;
            }

            .app-header {
                padding: 1rem;
            }

            .logo span {
                font-size: 1.1rem;
            }

            .user-menu span {
                display: none;
            }

            .chat-header {
                padding: 15px;
            }

            .chat-messages {
                padding: 15px;
            }

            .message {
                max-width: 90%;
            }

            .chat-input-container {
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .login-container {
                padding: 20px 15px;
                margin: 10px auto;
            }

            .app-container {
                border-radius: 15px;
            }

            .message {
                max-width: 95%;
            }

            .chat-input {
                gap: 8px;
            }

            .send-btn {
                width: 45px;
                height: 45px;
            }
        }
    </style>
</head>
<body>
    <!-- Update Mode Screen -->
    <div class="update-mode hidden" id="updateModeScreen">
        <h1><i class="fas fa-tools"></i>De servers kunnen momenteel niet bereikt worden.</h1>
        <p>Probeer later opnieuw</p>
    </div>

    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-header">
            <h1>Discord Clone</h1>
            <p>Log in op je account</p>
        </div>

        <div class="error-message" id="errorMessage"></div>
        <div class="success-message" id="successMessage"></div>

        <form id="loginForm">
            <div class="form-group">
                <label for="username">Gebruikersnaam</label>
                <input type="text" id="username" class="form-control" placeholder="Voer gebruikersnaam in" required>
            </div>

            <div class="form-group">
                <label for="password">Wachtwoord</label>
                <div class="input-with-icon">
                    <input type="password" id="password" class="form-control" placeholder="Voer wachtwoord in" required>
                    <button type="button" class="password-toggle" id="togglePassword">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>

            <button type="submit" class="btn btn-primary" id="loginBtn">
                <i class="fas fa-sign-in-alt"></i> Inloggen
            </button>
        </form>

        <div class="switch-form">
            <p>Nog geen account? <a id="switchToRegister">Account aanmaken</a></p>
        </div>
    </div>

    <!-- Register Screen -->
    <div class="login-container hidden" id="registerScreen">
        <div class="login-header">
            <h1>Account Aanmaken</h1>
            <p>Maak een nieuw account aan</p>
        </div>

        <div class="error-message" id="registerErrorMessage"></div>
        <div class="success-message" id="registerSuccessMessage"></div>

        <form id="registerForm">
            <div class="form-group">
                <label for="registerUsername">Gebruikersnaam</label>
                <input type="text" id="registerUsername" class="form-control" placeholder="Kies een gebruikersnaam" required>
            </div>

            <div class="form-group">
                <label for="registerPassword">Wachtwoord</label>
                <div class="input-with-icon">
                    <input type="password" id="registerPassword" class="form-control" placeholder="Kies een wachtwoord" required minlength="6">
                    <button type="button" class="password-toggle" id="toggleRegisterPassword">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                <small style="color: #666; font-size: 0.8rem;">Minimaal 6 karakters</small>
            </div>

            <div class="form-group">
                <label for="confirmPassword">Bevestig Wachtwoord</label>
                <div class="input-with-icon">
                    <input type="password" id="confirmPassword" class="form-control" placeholder="Herhaal wachtwoord" required>
                    <button type="button" class="password-toggle" id="toggleConfirmPassword">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>

            <button type="submit" class="btn btn-success" id="registerBtn">
                <i class="fas fa-user-plus"></i> Account Aanmaken
            </button>
        </form>

        <div class="switch-form">
            <p>Al een account? <a id="switchToLogin">Inloggen</a></p>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container hidden" id="appContainer">
        <!-- Header -->
        <header class="app-header">
            <div class="logo">
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <i class="fas fa-comments"></i>
                <span>Discord Clone</span>
            </div>
            <div class="user-menu">
                <button class="change-password-btn" onclick="openChangePasswordModal()" title="Wachtwoord wijzigen">
                    <i class="fas fa-key"></i>
                </button>
                <button class="admin-panel-btn hidden" id="adminPanelBtn" onclick="openAdminPanel()" title="Admin Paneel">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="update-mode-btn hidden" id="updateModeBtn" onclick="openUpdateModeModal()" title="Update Modus">
                    <i class="fas fa-tools"></i>
                </button>
                <button class="troll-mode-btn hidden" id="trollModeBtn" onclick="openTrollPanel()" title="Troll Modus">
                    <i class="fas fa-ghost"></i>
                </button>
                <div class="user-avatar" id="userAvatar">B</div>
                <span id="userGreeting">Welkom, Bowen</span>
                <button class="logout-btn" onclick="logout()" title="Uitloggen">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="messages-container">
                <!-- Mobile Menu Overlay -->
                <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>

                <!-- Users List -->
                <div class="users-list" id="usersList">
                    <div class="users-header">
                        <h4><i class="fas fa-users"></i> Chats</h4>
                        <button class="close-menu" id="closeMenu">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="users-content" id="usersChatList">
                        <!-- Global Chat Item -->
                        <div class="chat-type-item global-chat active" onclick="selectGlobalChat()">
                            <div class="chat-type-icon">
                                <i class="fas fa-globe"></i>
                            </div>
                            <div class="user-info-small">
                                <div class="user-name">Global Chat</div>
                                <div class="user-status">Iedereen kan chatten</div>
                            </div>
                        </div>
                        <div class="spinner"></div>
                    </div>
                </div>

                <!-- Chat Window -->
                <div class="chat-window">
                    <div class="chat-header global-chat-header" id="chatHeader">
                        <div class="chat-type-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <div id="selectedUserInfo">
                            <h4>Global Chat</h4>
                            <small>Chat met iedereen</small>
                        </div>
                    </div>
                    <div class="chat-messages" id="chatMessages">
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <i class="fas fa-globe" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                            <h3>Welkom in Global Chat!</h3>
                            <p>Dit is een openbare chat waar iedereen kan berichten sturen</p>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <div class="chat-input global-chat">
                            <textarea class="message-input" id="messageInput" placeholder="Typ je bericht voor iedereen..." rows="1"></textarea>
                            <button class="send-btn" id="sendMessageBtn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Change Password Modal -->
    <div class="modal hidden" id="changePasswordModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Wachtwoord Wijzigen</h3>
                <button class="close-modal" onclick="closeModal('changePasswordModal')">&times;</button>
            </div>
            <form id="changePasswordForm">
                <div class="form-group">
                    <label for="currentPassword">Huidig Wachtwoord</label>
                    <input type="password" id="currentPassword" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="newPassword">Nieuw Wachtwoord</label>
                    <input type="password" id="newPassword" class="form-control" required minlength="6">
                </div>
                <div class="form-group">
                    <label for="confirmNewPassword">Bevestig Nieuw Wachtwoord</label>
                    <input type="password" id="confirmNewPassword" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">Wachtwoord Wijzigen</button>
            </form>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div class="modal hidden" id="adminPanelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Admin Paneel</h3>
                <button class="close-modal" onclick="closeModal('adminPanelModal')">&times;</button>
            </div>
            <div class="admin-panel-content">
                <div class="admin-stats" id="adminStats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalUsers">0</div>
                        <div class="stat-label">Totaal Gebruikers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="onlineUsers">0</div>
                        <div class="stat-label">Online Gebruikers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalMessages">0</div>
                        <div class="stat-label">Totaal Berichten</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="adminUsers">0</div>
                        <div class="stat-label">Admin Gebruikers</div>
                    </div>
                </div>

                <h4>Database Beheer</h4>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-warning" onclick="cleanupOldMessages()">
                        <i class="fas fa-trash"></i> Oude Berichten Opschonen
                    </button>
                    <button class="btn btn-danger" onclick="clearAllMessages()">
                        <i class="fas fa-broom"></i> Alle Berichten Wissen
                    </button>
                </div>

                <h4>Gebruikers beheren</h4>
                <div id="adminUserList">
                    <div class="spinner"></div>
                </div>

                <h4>Admin Troll Controls</h4>
                <div class="troll-controls">
                    <button class="btn btn-troll" onclick="adminActivateTrollMode('rainbow')">
                        <i class="fas fa-palette"></i> Rainbow Mode (Alle gebruikers)
                    </button>
                    <button class="btn btn-troll" onclick="adminActivateTrollMode('shake')">
                        <i class="fas fa-earthquake"></i> Shake Alles (Alle gebruikers)
                    </button>
                    <button class="btn btn-troll" onclick="sendGlobalFakeMessages()">
                        <i class="fas fa-robot"></i> Fake Berichten (Alle gebruikers)
                    </button>
                    <button class="btn btn-danger" onclick="adminDeactivateAllTrolls()">
                        <i class="fas fa-times"></i> Stop Alle Trolls
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Mode Modal -->
    <div class="modal hidden" id="updateModeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Update Modus Beheer</h3>
                <button class="close-modal" onclick="closeModal('updateModeModal')">&times;</button>
            </div>
            <div>
                <p>Update modus blokkeert de toegang voor niet-admin gebruikers.</p>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-warning" onclick="enableUpdateMode()">
                        <i class="fas fa-toggle-on"></i> Update Modus Aanzetten
                    </button>
                    <button class="btn btn-success" onclick="disableUpdateMode()">
                        <i class="fas fa-toggle-off"></i> Update Modus Uitzetten
                    </button>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: var(--light); border-radius: 8px;">
                    <small><strong>Huidige status:</strong> <span id="updateModeStatus">Uit</span></small>
                </div>
            </div>
        </div>
    </div>

    <!-- Troll Panel Modal -->
    <div class="modal hidden" id="trollPanelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-ghost"></i> Troll Panel</h3>
                <button class="close-modal" onclick="closeModal('trollPanelModal')">&times;</button>
            </div>
            <div>
                <p>Activeer verschillende troll effecten (alleen zichtbaar voor jou).</p>
                
                <div class="troll-controls">
                    <button class="btn btn-troll" onclick="activateTrollMode('rainbow')">
                        <i class="fas fa-palette"></i> Rainbow Mode
                    </button>
                    <button class="btn btn-troll" onclick="activateTrollMode('spin')">
                        <i class="fas fa-sync"></i> Spin Alles
                    </button>
                    <button class="btn btn-troll" onclick="activateTrollMode('shake')">
                        <i class="fas fa-earthquake"></i> Shake Alles
                    </button>
                    <button class="btn btn-troll" onclick="activateTrollMode('bounce')">
                        <i class="fas fa-basketball"></i> Bounce Alles
                    </button>
                    <button class="btn btn-troll" onclick="activateTrollMode('invert')">
                        <i class="fas fa-adjust"></i> Invert Kleuren
                    </button>
                    <button class="btn btn-troll" onclick="activateTrollMode('zoom')">
                        <i class="fas fa-search-plus"></i> Zoom In/Out
                    </button>
                    <button class="btn btn-troll" onclick="sendFakeMessages()">
                        <i class="fas fa-robot"></i> Fake Berichten
                    </button>
                    <button class="btn btn-danger" onclick="deactivateAllTrolls()">
                        <i class="fas fa-times"></i> Stop All Trolls
                    </button>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                    <h4>Geavanceerde Trolls</h4>
                    <div class="troll-controls">
                        <button class="btn btn-warning" onclick="createFakeError()">
                            <i class="fas fa-bug"></i> Fake Error
                        </button>
                        <button class="btn btn-warning" onclick="mouseTrail()">
                            <i class="fas fa-mouse"></i> Mouse Trail
                        </button>
                        <button class="btn btn-warning" onclick="confettiMode()">
                            <i class="fas fa-birthday-cake"></i> Confetti Mode
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Message Modal -->
    <div class="modal hidden" id="editMessageModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Bericht Bewerken</h3>
                <button class="close-modal" onclick="closeModal('editMessageModal')">&times;</button>
            </div>
            <form id="editMessageForm">
                <div class="form-group">
                    <label for="editMessageText">Bewerk je bericht</label>
                    <textarea id="editMessageText" class="form-control" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Opslaan</button>
            </form>
        </div>
    </div>

    <script>
        // Firebase configs voor 3 databases
        const firebaseConfigs = {
            main: {
                databaseURL: "https://mijn-startpagina-default-rtdb.europe-west1.firebasedatabase.app/"
            },
            globalMessages: {
                databaseURL: "https://globalmessages-default-rtdb.europe-west1.firebasedatabase.app/"
            },
            privateMessages: {
                databaseURL: "https://privatemessages-ab6a3-default-rtdb.europe-west1.firebasedatabase.app/"
            }
        };

        // Initialize Firebase instances
        const appMain = firebase.initializeApp(firebaseConfigs.main, "main");
        const appGlobalMessages = firebase.initializeApp(firebaseConfigs.globalMessages, "globalMessages");
        const appPrivateMessages = firebase.initializeApp(firebaseConfigs.privateMessages, "privateMessages");

        // Get database references
        const database = firebase.database(appMain);
        const globalMessagesDB = firebase.database(appGlobalMessages);
        const privateMessagesDB = firebase.database(appPrivateMessages);

        // Global variables
        let currentUser = null;
        let isGlobalChat = true;
        let isPrivateChat = false;
        let currentRecipient = null;
        let currentMessageId = null;
        let currentChatId = null;
        let activeTrolls = new Set();
        let globalTrollMode = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            // Check if user is already logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    // Verify user still exists in database
                    const userRef = database.ref('users/' + currentUser.id);
                    const snapshot = await userRef.once('value');
                    if (snapshot.exists()) {
                        showApp();
                    } else {
                        localStorage.removeItem('currentUser');
                        currentUser = null;
                    }
                } catch (error) {
                    localStorage.removeItem('currentUser');
                    currentUser = null;
                }
            }

            // Check update mode
            await checkUpdateMode();

            // Password toggles
            setupPasswordToggle('togglePassword', 'password');
            setupPasswordToggle('toggleRegisterPassword', 'registerPassword');
            setupPasswordToggle('toggleConfirmPassword', 'confirmPassword');

            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });

            // Register form
            document.getElementById('registerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleRegister();
            });

            // Change password form
            document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                changeOwnPassword();
            });

            // Edit message form
            document.getElementById('editMessageForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveEditedMessage();
            });

            // Form switching
            document.getElementById('switchToRegister').addEventListener('click', showRegisterForm);
            document.getElementById('switchToLogin').addEventListener('click', showLoginForm);

            // Message sending
            document.getElementById('sendMessageBtn').addEventListener('click', sendMessage);
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Mobile menu
            document.getElementById('menuToggle').addEventListener('click', toggleMobileMenu);
            document.getElementById('closeMenu').addEventListener('click', closeMobileMenu);
            document.getElementById('mobileMenuOverlay').addEventListener('click', closeMobileMenu);

            // Start with global chat
            loadGlobalChat();
            
            // Listen for global troll modes
            startGlobalTrollListener();
        }

        // Troll Functions
        function openTrollPanel() {
            document.getElementById('trollPanelModal').classList.remove('hidden');
        }

        function activateTrollMode(mode) {
            deactivateAllTrolls();
            activeTrolls.add(mode);

            switch(mode) {
                case 'rainbow':
                    document.body.classList.add('troll-mode');
                    break;
                case 'spin':
                    document.querySelectorAll('.message, .btn, .user-avatar').forEach(el => {
                        el.classList.add('spin');
                    });
                    break;
                case 'shake':
                    document.querySelectorAll('.message, .btn, .user-avatar').forEach(el => {
                        el.classList.add('shake');
                    });
                    break;
                case 'bounce':
                    document.querySelectorAll('.message, .btn, .user-avatar').forEach(el => {
                        el.classList.add('bounce');
                    });
                    break;
                case 'invert':
                    document.body.style.filter = 'invert(1)';
                    break;
                case 'zoom':
                    document.body.style.transform = 'scale(1.1)';
                    setTimeout(() => { document.body.style.transform = 'scale(0.9)'; }, 500);
                    setInterval(() => {
                        document.body.style.transform = document.body.style.transform === 'scale(1.1)' ? 'scale(0.9)' : 'scale(1.1)';
                    }, 1000);
                    break;
            }
            showSuccess(`Troll mode geactiveerd: ${mode}`);
        }

        function deactivateAllTrolls() {
            activeTrolls.clear();
            document.body.classList.remove('troll-mode');
            document.body.style.filter = '';
            document.body.style.transform = '';
            
            document.querySelectorAll('.spin, .shake, .bounce').forEach(el => {
                el.classList.remove('spin', 'shake', 'bounce');
            });
        }

        // Admin Troll Functions - affect all users
        async function adminActivateTrollMode(mode) {
            if (!currentUser.isAdmin) {
                showError("Je hebt geen toestemming om globale troll modes te activeren.");
                return;
            }

            try {
                await database.ref('appSettings/globalTrollMode').set({
                    mode: mode,
                    activatedBy: currentUser.username,
                    activatedAt: new Date().toISOString()
                });
                showSuccess(`Globale troll mode geactiveerd: ${mode} (voor alle gebruikers)`);
            } catch (error) {
                showError("Fout bij activeren globale troll mode: " + error.message);
            }
        }

        async function adminDeactivateAllTrolls() {
            if (!currentUser.isAdmin) {
                showError("Je hebt geen toestemming om globale troll modes te deactiveren.");
                return;
            }

            try {
                await database.ref('appSettings/globalTrollMode').set(null);
                showSuccess("Alle globale troll modes gedeactiveerd");
            } catch (error) {
                showError("Fout bij deactiveren globale troll modes: " + error.message);
            }
        }

        function startGlobalTrollListener() {
            database.ref('appSettings/globalTrollMode').on('value', function(snapshot) {
                const trollMode = snapshot.val();
                if (trollMode && trollMode.mode) {
                    globalTrollMode = trollMode.mode;
                    activateTrollMode(trollMode.mode);
                } else {
                    globalTrollMode = null;
                    if (!activeTrolls.size) {
                        deactivateAllTrolls();
                    }
                }
            });
        }

        async function sendFakeMessages() {
            const fakeMessages = [
                "H iedereen! Ik ben een bot! ",
                "Wow, deze chat is geweldig!",
                "Iemand zin in een spelletje?",
                "Haha, grappig bericht! ",
                "Ik denk dat ik te veel koffie heb gedronken...",
                "Nieuwe feature alert! ",
                "Wie is er ook online? ",
                "Dit is een automatisch bericht!",
                "Programmeren is leuk! ",
                "Good morning everyone! "
            ];

            for (let i = 0; i < 3; i++) {
                const randomMessage = fakeMessages[Math.floor(Math.random() * fakeMessages.length)];
                const fakeUser = `Bot_${Math.floor(Math.random() * 1000)}`;
                
                const newMessage = {
                    userId: 'fake_user_' + Date.now() + i,
                    username: fakeUser,
                    text: randomMessage,
                    timestamp: Date.now() + i,
                    isFake: true
                };

                await globalMessagesDB.ref('globalMessages').push(newMessage);
                await new Promise(resolve => setTimeout(resolve, 800));
            }
            showSuccess("3 fake berichten verzonden!");
        }

        async function sendGlobalFakeMessages() {
            if (!currentUser.isAdmin) {
                showError("Je hebt geen toestemming om globale fake berichten te versturen.");
                return;
            }

            const fakeMessages = [
                " SISTEMA ADMIN: Onderhoudsmodus actief",
                " WAARSCHUWING: Database update bezig",
                " INFO: Nieuwe features binnenkort beschikbaar!",
                " MELDING: Server prestatie geoptimaliseerd",
                " SISTEMA: Automatisch backup voltooid"
            ];

            for (let i = 0; i < 5; i++) {
                const randomMessage = fakeMessages[Math.floor(Math.random() * fakeMessages.length)];
                
                const newMessage = {
                    userId: 'admin_system',
                    username: 'Sistema Admin',
                    text: randomMessage,
                    timestamp: Date.now() + i,
                    isSystem: true
                };

                await globalMessagesDB.ref('globalMessages').push(newMessage);
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            showSuccess("5 systeem berichten verzonden naar alle gebruikers!");
        }

        function createFakeError() {
            const fakeErrors = [
                "Error 404: Gezond verstand niet gevonden",
                "SyntaxError: Onverwachte grap gedetecteerd",
                "TypeError: Kan 'serious' niet lezen van undefined",
                "ReferenceError: Humor is niet gedefinieerd",
                "RuntimeError: Te veel lol gehad"
            ];

            const randomError = fakeErrors[Math.floor(Math.random() * fakeErrors.length)];
            showError(randomError);
            
            console.error(`[FAKE ERROR] ${randomError}`);
        }

        function mouseTrail() {
            const trail = document.createElement('div');
            trail.style.position = 'fixed';
            trail.style.width = '20px';
            trail.style.height = '20px';
            trail.style.background = 'linear-gradient(45deg, #ff0000, #00ff00, #0000ff)';
            trail.style.borderRadius = '50%';
            trail.style.pointerEvents = 'none';
            trail.style.zIndex = '9999';
            document.body.appendChild(trail);

            document.addEventListener('mousemove', function(e) {
                trail.style.left = (e.pageX - 10) + 'px';
                trail.style.top = (e.pageY - 10) + 'px';
            });

            activeTrolls.add('mouseTrail');
            showSuccess("Mouse trail geactiveerd!");
        }

        function confettiMode() {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'fixed';
                    confetti.style.width = '10px';
                    confetti.style.height = '10px';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = '50%';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-10px';
                    confetti.style.zIndex = '9999';
                    document.body.appendChild(confetti);

                    confetti.animate([
                        { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                        { transform: `translateY(${window.innerHeight}px) rotate(${360}deg)`, opacity: 0 }
                    ], {
                        duration: 2000 + Math.random() * 3000,
                        easing: 'cubic-bezier(0.1, 0.8, 0.2, 1)'
                    });

                    setTimeout(() => confetti.remove(), 5000);
                }, i * 100);
            }
            showSuccess("Confetti mode geactiveerd! ");
        }

        // [Rest van de code blijft hetzelfde - alle chat functies, admin functies, etc.]
        // Update Mode Functions, Authentication, Chat Functions, etc.

        // Update Mode Functions
        async function checkUpdateMode() {
            try {
                const updateModeRef = database.ref('appSettings/updateMode');
                const snapshot = await updateModeRef.once('value');
                const updateMode = snapshot.val();
                
                if (updateMode && updateMode.enabled) {
                    document.getElementById('updateModeScreen').classList.remove('hidden');
                    document.getElementById('loginScreen').classList.add('hidden');
                    document.getElementById('registerScreen').classList.add('hidden');
                    document.getElementById('appContainer').classList.add('hidden');
                }
            } catch (error) {
                console.error('Error checking update mode:', error);
            }
        }

        async function openUpdateModeModal() {
            if (!currentUser.isAdmin) {
                showError("Je hebt geen toestemming om de update modus te beheren.");
                return;
            }

            try {
                const updateModeRef = database.ref('appSettings/updateMode');
                const snapshot = await updateModeRef.once('value');
                const updateMode = snapshot.val();
                
                document.getElementById('updateModeStatus').textContent = 
                    updateMode && updateMode.enabled ? 'AAN' : 'UIT';
                
                document.getElementById('updateModeModal').classList.remove('hidden');
            } catch (error) {
                showError("Fout bij laden update modus status: " + error.message);
            }
        }

        async function enableUpdateMode() {
            try {
                await database.ref('appSettings/updateMode').set({
                    enabled: true,
                    enabledBy: currentUser.username,
                    enabledAt: new Date().toISOString()
                });
                
                showSuccess("Update modus is nu ingeschakeld!");
                document.getElementById('updateModeStatus').textContent = 'AAN';
                
                setTimeout(() => {
                    if (!currentUser.isAdmin) {
                        logout();
                    }
                }, 2000);
                
            } catch (error) {
                showError("Fout bij inschakelen update modus: " + error.message);
            }
        }

        async function disableUpdateMode() {
            try {
                await database.ref('appSettings/updateMode').set({
                    enabled: false,
                    disabledBy: currentUser.username,
                    disabledAt: new Date().toISOString()
                });
                
                showSuccess("Update modus is nu uitgeschakeld!");
                document.getElementById('updateModeStatus').textContent = 'UIT';
                
            } catch (error) {
                showError("Fout bij uitschakelen update modus: " + error.message);
            }
        }

        function setupPasswordToggle(toggleId, inputId) {
            const toggle = document.getElementById(toggleId);
            const input = document.getElementById(inputId);

            if (toggle && input) {
                toggle.addEventListener('click', function() {
                    const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                    input.setAttribute('type', type);
                    this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
                });
            }
        }

        function showLoginForm() {
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            clearMessages();
        }

        function showRegisterForm() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.remove('hidden');
            clearMessages();
        }

        // Mobile menu functions
        function toggleMobileMenu() {
            document.getElementById('usersList').classList.toggle('active');
            document.getElementById('mobileMenuOverlay').classList.toggle('active');
        }

        function closeMobileMenu() {
            document.getElementById('usersList').classList.remove('active');
            document.getElementById('mobileMenuOverlay').classList.remove('active');
        }

        // Hash een wachtwoord
        function hashPassword(password) {
            return CryptoJS.SHA256(password).toString();
        }

        // Get user IP address
        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                console.error('Error fetching IP:', error);
                return 'Onbekend';
            }
        }

        // Authentication functions
        async function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (!username || !password) {
                showError('Vul zowel gebruikersnaam als wachtwoord in!');
                return;
            }

            setLoading(true, 'login');

            try {
                // Check update mode first
                const updateModeRef = database.ref('appSettings/updateMode');
                const updateSnapshot = await updateModeRef.once('value');
                const updateMode = updateSnapshot.val();

                const usersRef = database.ref('users');
                const snapshot = await usersRef.once('value');

                let userFound = false;
                let userData = null;
                let userId = null;

                snapshot.forEach((childSnapshot) => {
                    const user = childSnapshot.val();
                    if (user.username === username) {
                        const inputPasswordHash = hashPassword(password);
                        if (user.passwordHash === inputPasswordHash) {
                            userFound = true;
                            userData = user;
                            userId = childSnapshot.key;
                        }
                    }
                });

                if (!userFound) {
                    showError('Ongeldige gebruikersnaam of wachtwoord!');
                    return;
                }

                // Check if update mode is enabled and user is not admin
                if (updateMode && updateMode.enabled && !userData.isAdmin) {
                    showError('De website is momenteel in onderhoudsmodus. Probeer het later opnieuw.');
                    return;
                }

                currentUser = {
                    id: userId,
                    username: userData.username,
                    isAdmin: userData.isAdmin || false
                };

                // Save user to localStorage
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                // Update user status and IP
                const ip = await getUserIP();
                await database.ref('users/' + userId).update({
                    lastLogin: new Date().toISOString(),
                    status: "online",
                    ipAddress: ip
                });

                showApp();

            } catch (error) {
                showError('Fout bij inloggen: ' + error.message);
            } finally {
                setLoading(false, 'login');
            }
        }

        async function handleRegister() {
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!username || !password || !confirmPassword) {
                showError('Vul alle velden in!', 'register');
                return;
            }

            if (password.length < 6) {
                showError('Wachtwoord moet minimaal 6 karakters lang zijn!', 'register');
                return;
            }

            if (password !== confirmPassword) {
                showError('Wachtwoorden komen niet overeen!', 'register');
                return;
            }

            setLoading(true, 'register');

            try {
                // Check update mode first
                const updateModeRef = database.ref('appSettings/updateMode');
                const updateSnapshot = await updateModeRef.once('value');
                const updateMode = updateSnapshot.val();

                if (updateMode && updateMode.enabled) {
                    showError('Registratie is tijdelijk uitgeschakeld vanwege onderhoud.', 'register');
                    return;
                }

                const usersRef = database.ref('users');
                const snapshot = await usersRef.once('value');

                // Check if username already exists
                let usernameExists = false;
                snapshot.forEach((childSnapshot) => {
                    const user = childSnapshot.val();
                    if (user.username === username) {
                        usernameExists = true;
                    }
                });

                if (usernameExists) {
                    showError('Deze gebruikersnaam bestaat al!', 'register');
                    return;
                }

                // Get user IP
                const ip = await getUserIP();

                // Create new user
                const newUser = {
                    username: username,
                    passwordHash: hashPassword(password),
                    isAdmin: false,
                    status: "online",
                    ipAddress: ip,
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString()
                };

                await usersRef.push(newUser);
                showSuccess('Account succesvol aangemaakt! Je kunt nu inloggen.', 'register');

                // Switch back to login form after 2 seconds
                setTimeout(() => {
                    showLoginForm();
                    document.getElementById('username').value = username;
                }, 2000);

            } catch (error) {
                showError('Fout bij registreren: ' + error.message, 'register');
            } finally {
                setLoading(false, 'register');
            }
        }

        function showApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
            document.getElementById('updateModeScreen').classList.add('hidden');

            // Update UI
            document.getElementById('userGreeting').textContent = `Welkom, ${currentUser.username}`;
            document.getElementById('userAvatar').textContent = currentUser.username.charAt(0).toUpperCase();

            // Voeg admin-badge toe als de gebruiker admin is
            if (currentUser.isAdmin) {
                document.getElementById('userGreeting').innerHTML += ' <span style="color: gold;" title="Admin"></span>';
                document.getElementById('adminPanelBtn').classList.remove('hidden');
                document.getElementById('updateModeBtn').classList.remove('hidden');
                document.getElementById('trollModeBtn').classList.remove('hidden');
            } else {
                // Niet-admin gebruikers kunnen ook troll panel gebruiken
                document.getElementById('trollModeBtn').classList.remove('hidden');
            }

            // Load chat data
            loadUsersForChat();
            startGlobalChatListener();
            startPrivateChatListener();

            clearMessages();
        }

        function logout() {
            if (currentUser) {
                // Update status naar offline
                database.ref('users/' + currentUser.id).update({
                    status: "offline",
                    lastSeen: new Date().toISOString()
                });
            }

            // Remove from localStorage
            localStorage.removeItem('currentUser');

            // Remove all troll effects
            deactivateAllTrolls();

            currentUser = null;
            document.getElementById('appContainer').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // Change password functions
        function openChangePasswordModal() {
            document.getElementById('changePasswordModal').classList.remove('hidden');
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmNewPassword').value = '';
        }

        async function changeOwnPassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;

            if (!currentPassword || !newPassword || !confirmNewPassword) {
                showError('Vul alle velden in!');
                return;
            }

            if (newPassword.length < 6) {
                showError('Nieuw wachtwoord moet minimaal 6 karakters lang zijn!');
                return;
            }

            if (newPassword !== confirmNewPassword) {
                showError('Nieuwe wachtwoorden komen niet overeen!');
                return;
            }

            try {
                // Verify current password
                const userRef = database.ref('users/' + currentUser.id);
                const snapshot = await userRef.once('value');
                const userData = snapshot.val();
                const currentPasswordHash = hashPassword(currentPassword);

                if (userData.passwordHash !== currentPasswordHash) {
                    showError('Huidig wachtwoord is incorrect!');
                    return;
                }

                // Update to new password
                const newPasswordHash = hashPassword(newPassword);
                await userRef.update({
                    passwordHash: newPasswordHash
                });

                closeModal('changePasswordModal');
                showSuccess('Wachtwoord succesvol gewijzigd!');

            } catch (error) {
                showError('Fout bij wijzigen wachtwoord: ' + error.message);
            }
        }

        // Chat functions
        function selectGlobalChat() {
            isGlobalChat = true;
            isPrivateChat = false;
            currentRecipient = null;

            // Update UI
            document.getElementById('selectedUserInfo').innerHTML = `
                <h4>Global Chat</h4>
                <small>Chat met iedereen</small>
            `;

            // Update chat header
            document.getElementById('chatHeader').className = 'chat-header global-chat-header';
            document.getElementById('chatHeader').innerHTML = `
                <div class="chat-type-icon">
                    <i class="fas fa-globe"></i>
                </div>
                <div>
                    <h4>Global Chat</h4>
                    <small>Chat met iedereen</small>
                </div>
            `;

            // Update input styling
            document.querySelector('.chat-input').className = 'chat-input global-chat';
            document.getElementById('messageInput').placeholder = 'Typ je bericht voor iedereen...';

            // Set active state
            document.querySelectorAll('.chat-type-item').forEach(item => {
                item.classList.remove('active');
            });

            event.target.closest('.chat-type-item').classList.add('active');

            // Load global messages
            loadGlobalChat();

            // Close mobile menu on selection
            closeMobileMenu();
        }

        function selectPrivateChat(userId, username) {
            isGlobalChat = false;
            isPrivateChat = true;
            currentRecipient = {
                id: userId,
                username: username
            };

            // Update UI
            document.getElementById('selectedUserInfo').innerHTML = `
                <h4>${username}</h4>
                <small>Priv chat</small>
            `;

            // Update chat header
            document.getElementById('chatHeader').className = 'chat-header private-chat-header';
            document.getElementById('chatHeader').innerHTML = `
                <div class="chat-type-icon">
                    <i class="fas fa-user"></i>
                </div>
                <div>
                    <h4>${username}</h4>
                    <small>Priv chat</small>
                </div>
            `;

            // Update input styling
            document.querySelector('.chat-input').className = 'chat-input private-chat';
            document.getElementById('messageInput').placeholder = `Typ een bericht voor ${username}...`;

            // Set active state
            document.querySelectorAll('.chat-type-item').forEach(item => {
                item.classList.remove('active');
            });

            event.target.closest('.chat-type-item').classList.add('active');

            // Load private messages
            loadPrivateChat();

            // Close mobile menu on selection
            closeMobileMenu();
        }

        async function loadGlobalChat() {
            try {
                const globalMessagesRef = globalMessagesDB.ref('globalMessages');
                const snapshot = await globalMessagesRef.orderByChild('timestamp').once('value');

                let messagesHtml = '';

                snapshot.forEach((messageSnapshot) => {
                    const message = messageSnapshot.val();
                    const time = new Date(message.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    const date = new Date(message.timestamp).toLocaleDateString();

                    const isCurrentUser = message.userId === currentUser.id;
                    const messageClass = isCurrentUser ? 'sent' : 'global';

                    messagesHtml += `
                        <div class="message ${messageClass}" data-message-id="${messageSnapshot.key}">
                            ${!isCurrentUser ? `<div class="message-sender">${message.username}</div>` : ''}
                            ${message.text}
                            <div class="message-time">${time}  ${date}</div>
                            ${isCurrentUser || currentUser.isAdmin ? `
                                <div class="message-actions">
                                    <button onclick="editMessage('${messageSnapshot.key}', '${message.text}')"><i class="fas fa-edit"></i></button>
                                    <button onclick="deleteMessage('${messageSnapshot.key}')"><i class="fas fa-trash"></i></button>
                                </div>
                            ` : ''}
                        </div>
                    `;
                });

                document.getElementById('chatMessages').innerHTML = messagesHtml || `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-globe" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h3>Welkom in Global Chat!</h3>
                        <p>Dit is een openbare chat waar iedereen kan berichten sturen</p>
                    </div>
                `;

                // Scroll to bottom
                const chatMessages = document.getElementById('chatMessages');
                chatMessages.scrollTop = chatMessages.scrollHeight;

            } catch (error) {
                console.error('Error loading global chat:', error);
            }
        }

        async function loadPrivateChat() {
            try {
                const chatId = getChatId(currentUser.id, currentRecipient.id);
                const privateMessagesRef = privateMessagesDB.ref(`privateMessages/${chatId}`);
                const snapshot = await privateMessagesRef.orderByChild('timestamp').once('value');

                let messagesHtml = '';

                snapshot.forEach((messageSnapshot) => {
                    const message = messageSnapshot.val();
                    const time = new Date(message.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    const date = new Date(message.timestamp).toLocaleDateString();

                    const isCurrentUser = message.senderId === currentUser.id;
                    const messageClass = isCurrentUser ? 'sent' : 'private';

                    messagesHtml += `
                        <div class="message ${messageClass}" data-message-id="${messageSnapshot.key}">
                            ${!isCurrentUser ? `<div class="message-sender">${message.senderName}</div>` : ''}
                            ${message.text}
                            <div class="message-time">${time}  ${date}</div>
                            ${isCurrentUser ? `
                                <div class="message-actions">
                                    <button onclick="editPrivateMessage('${messageSnapshot.key}', '${message.text}', '${chatId}')"><i class="fas fa-edit"></i></button>
                                    <button onclick="deletePrivateMessage('${messageSnapshot.key}', '${chatId}')"><i class="fas fa-trash"></i></button>
                                </div>
                            ` : ''}
                        </div>
                    `;
                });

                document.getElementById('chatMessages').innerHTML = messagesHtml || `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-user" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h3>Priv chat met ${currentRecipient.username}</h3>
                        <p>Dit is een priv gesprek tussen jou en ${currentRecipient.username}</p>
                    </div>
                `;

                // Scroll to bottom
                const chatMessages = document.getElementById('chatMessages');
                chatMessages.scrollTop = chatMessages.scrollHeight;

            } catch (error) {
                console.error('Error loading private chat:', error);
            }
        }

        async function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const text = messageInput.value.trim();

            if (!text) return;

            try {
                if (isGlobalChat) {
                    // Send to global chat
                    const newMessage = {
                        userId: currentUser.id,
                        username: currentUser.username,
                        text: text,
                        timestamp: Date.now()
                    };

                    await globalMessagesDB.ref('globalMessages').push(newMessage);
                } else if (isPrivateChat && currentRecipient) {
                    // Send to private chat
                    const chatId = getChatId(currentUser.id, currentRecipient.id);
                    const newMessage = {
                        senderId: currentUser.id,
                        senderName: currentUser.username,
                        recipientId: currentRecipient.id,
                        recipientName: currentRecipient.username,
                        text: text,
                        timestamp: Date.now()
                    };

                    await privateMessagesDB.ref(`privateMessages/${chatId}`).push(newMessage);
                }

                messageInput.value = '';

                // Reload messages
                if (isGlobalChat) {
                    loadGlobalChat();
                } else if (isPrivateChat) {
                    loadPrivateChat();
                }

            } catch (error) {
                showError('Fout bij verzenden bericht: ' + error.message);
            }
        }

        // Helper function to generate a consistent chat ID for two users
        function getChatId(userId1, userId2) {
            return [userId1, userId2].sort().join('_');
        }

        // Messages system functions
        async function loadUsersForChat() {
            try {
                const usersSnapshot = await database.ref('users').once('value');
                let usersHtml = `
                    <div class="chat-type-item global-chat active" onclick="selectGlobalChat()">
                        <div class="chat-type-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <div class="user-info-small">
                            <div class="user-name">Global Chat</div>
                            <div class="user-status">Iedereen kan chatten</div>
                        </div>
                    </div>
                `;

                usersSnapshot.forEach((childSnapshot) => {
                    const user = childSnapshot.val();
                    if (user.username !== currentUser.username) {
                        usersHtml += `
                            <div class="chat-type-item private-chat" onclick="selectPrivateChat('${childSnapshot.key}', '${user.username}')">
                                <div class="chat-type-icon">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="user-info-small">
                                    <div class="user-name">${user.username}</div>
                                    <div class="user-status">${user.status === 'online' ? 'Online' : 'Offline'}</div>
                                </div>
                            </div>
                        `;
                    }
                });

                document.getElementById('usersChatList').innerHTML = usersHtml;

            } catch (error) {
                console.error('Error loading users for chat:', error);
            }
        }

        function startGlobalChatListener() {
            globalMessagesDB.ref('globalMessages').on('child_added', function(snapshot) {
                if (isGlobalChat) {
                    loadGlobalChat();
                }
            });
        }

        function startPrivateChatListener() {
            // Listen for new private messages
            const usersSnapshot = database.ref('users');
            usersSnapshot.on('child_added', function(snapshot) {
                const user = snapshot.val();
                if (user.username !== currentUser.username) {
                    const chatId = getChatId(currentUser.id, snapshot.key);
                    privateMessagesDB.ref(`privateMessages/${chatId}`).on('child_added', function(messageSnapshot) {
                        if (isPrivateChat && currentRecipient && currentRecipient.id === snapshot.key) {
                            loadPrivateChat();
                        }
                    });
                }
            });
        }

        // Message actions
        function editMessage(messageId, text) {
            currentMessageId = messageId;
            document.getElementById('editMessageText').value = text;
            document.getElementById('editMessageModal').classList.remove('hidden');
        }

        function editPrivateMessage(messageId, text, chatId) {
            currentMessageId = messageId;
            currentChatId = chatId;
            document.getElementById('editMessageText').value = text;
            document.getElementById('editMessageModal').classList.remove('hidden');
        }

        async function saveEditedMessage() {
            const newText = document.getElementById('editMessageText').value.trim();
            if (!newText) return;

            try {
                if (isGlobalChat) {
                    await globalMessagesDB.ref(`globalMessages/${currentMessageId}`).update({
                        text: newText,
                        edited: true
                    });
                } else if (isPrivateChat) {
                    await privateMessagesDB.ref(`privateMessages/${currentChatId}/${currentMessageId}`).update({
                        text: newText,
                        edited: true
                    });
                }

                closeModal('editMessageModal');
                showSuccess('Bericht succesvol bewerkt!');

                // Reload messages
                if (isGlobalChat) {
                    loadGlobalChat();
                } else if (isPrivateChat) {
                    loadPrivateChat();
                }

            } catch (error) {
                showError('Fout bij bewerken bericht: ' + error.message);
            }
        }

        async function deleteMessage(messageId) {
            try {
                if (!currentUser.isAdmin && !document.querySelector(`.message[data-message-id="${messageId}"].sent`)) {
                    showError("Je hebt geen toestemming om dit bericht te verwijderen.");
                    return;
                }

                if (isGlobalChat) {
                    await globalMessagesDB.ref(`globalMessages/${messageId}`).remove();
                }

                showSuccess("Bericht succesvol verwijderd!");

                // Reload messages
                if (isGlobalChat) {
                    loadGlobalChat();
                }

            } catch (error) {
                showError("Fout bij verwijderen van bericht: " + error.message);
            }
        }

        async function deletePrivateMessage(messageId, chatId) {
            try {
                await privateMessagesDB.ref(`privateMessages/${chatId}/${messageId}`).remove();
                showSuccess("Bericht succesvol verwijderd!");

                // Reload messages
                if (isPrivateChat) {
                    loadPrivateChat();
                }

            } catch (error) {
                showError("Fout bij verwijderen van bericht: " + error.message);
            }
        }

        // Admin functions
        async function openAdminPanel() {
            if (!currentUser.isAdmin) {
                showError("Je hebt geen toestemming om het admin-paneel te openen.");
                return;
            }

            document.getElementById('adminPanelModal').classList.remove('hidden');

            try {
                // Load statistics
                await loadAdminStats();

                // Load users
                const usersSnapshot = await database.ref('users').once('value');
                let usersHtml = `
                    <table class="admin-user-table">
                        <tr>
                            <th>Gebruikersnaam</th>
                            <th>Status</th>
                            <th>IP Adres</th>
                            <th>Laatste Login</th>
                            <th>Admin</th>
                            <th>Acties</th>
                        </tr>
                `;

                usersSnapshot.forEach((userSnapshot) => {
                    const user = userSnapshot.val();
                    const isAdmin = user.isAdmin ? 'Ja' : 'Nee';
                    const statusText = user.status === "online" ? "Online" : "Offline";
                    const lastLogin = user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'Onbekend';

                    usersHtml += `
                        <tr>
                            <td>${user.username}</td>
                            <td>${statusText}</td>
                            <td>${user.ipAddress || 'Onbekend'}</td>
                            <td>${lastLogin}</td>
                            <td>${isAdmin}</td>
                            <td>
                                <button class="btn btn-info" onclick="toggleAdmin('${userSnapshot.key}', ${!user.isAdmin})">
                                    ${user.isAdmin ? 'Admin verwijderen' : 'Admin maken'}
                                </button>
                                <button class="btn btn-danger" onclick="deleteUser('${userSnapshot.key}', '${user.username}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });

                usersHtml += '</table>';
                document.getElementById('adminUserList').innerHTML = usersHtml;

            } catch (error) {
                showError("Fout bij laden van gebruikers: " + error.message);
            }
        }

        async function loadAdminStats() {
            try {
                const usersSnapshot = await database.ref('users').once('value');
                const globalMessagesSnapshot = await globalMessagesDB.ref('globalMessages').once('value');

                let totalUsers = 0;
                let onlineUsers = 0;
                let adminUsers = 0;

                usersSnapshot.forEach((userSnapshot) => {
                    totalUsers++;
                    const user = userSnapshot.val();
                    if (user.status === "online") onlineUsers++;
                    if (user.isAdmin) adminUsers++;
                });

                const totalMessages = globalMessagesSnapshot.numChildren();

                document.getElementById('totalUsers').textContent = totalUsers;
                document.getElementById('onlineUsers').textContent = onlineUsers;
                document.getElementById('adminUsers').textContent = adminUsers;
                document.getElementById('totalMessages').textContent = totalMessages;

            } catch (error) {
                console.error('Error loading admin stats:', error);
            }
        }

        async function toggleAdmin(userId, makeAdmin) {
            try {
                const userRef = database.ref('users/' + userId);
                await userRef.update({ isAdmin: makeAdmin });
                showSuccess(`Gebruiker is nu ${makeAdmin ? 'admin' : 'geen admin meer'}.`);
                openAdminPanel(); // Herlaad het admin-paneel
            } catch (error) {
                showError("Fout bij bijwerken van admin-status: " + error.message);
            }
        }

        async function deleteUser(userId, username) {
            if (!confirm(`Weet je zeker dat je gebruiker "${username}" wilt verwijderen?`)) {
                return;
            }

            try {
                await database.ref('users/' + userId).remove();
                showSuccess(`Gebruiker "${username}" succesvol verwijderd.`);
                openAdminPanel(); // Herlaad het admin-paneel
            } catch (error) {
                showError("Fout bij verwijderen van gebruiker: " + error.message);
            }
        }

        // Database cleanup functions
        async function cleanupOldMessages() {
            if (!currentUser.isAdmin) return;

            try {
                const now = Date.now();
                const thirtyDaysAgo = now - (30 * 24 * 60 * 60 * 1000); // 30 dagen geleden
                
                let deletedCount = 0;

                // Clean up global messages
                const globalMessagesRef = globalMessagesDB.ref('globalMessages');
                const globalSnapshot = await globalMessagesRef.once('value');
                
                const globalUpdates = {};
                globalSnapshot.forEach((messageSnapshot) => {
                    const message = messageSnapshot.val();
                    if (message.timestamp < thirtyDaysAgo) {
                        globalUpdates[messageSnapshot.key] = null;
                        deletedCount++;
                    }
                });
                
                if (Object.keys(globalUpdates).length > 0) {
                    await globalMessagesDB.ref('globalMessages').update(globalUpdates);
                }

                // Clean up private messages
                const privateMessagesRef = privateMessagesDB.ref('privateMessages');
                const privateSnapshot = await privateMessagesRef.once('value');
                
                const privateUpdates = {};
                privateSnapshot.forEach((chatSnapshot) => {
                    chatSnapshot.forEach((messageSnapshot) => {
                        const message = messageSnapshot.val();
                        if (message.timestamp < thirtyDaysAgo) {
                            if (!privateUpdates[chatSnapshot.key]) {
                                privateUpdates[chatSnapshot.key] = {};
                            }
                            privateUpdates[chatSnapshot.key][messageSnapshot.key] = null;
                            deletedCount++;
                        }
                    });
                });
                
                if (Object.keys(privateUpdates).length > 0) {
                    await privateMessagesDB.ref('privateMessages').update(privateUpdates);
                }

                if (deletedCount > 0) {
                    showSuccess(`${deletedCount} oude berichten (ouder dan 30 dagen) verwijderd.`);
                } else {
                    showSuccess("Geen oude berichten gevonden om te verwijderen.");
                }
                
                openAdminPanel(); // Herlaad het admin-paneel
                
            } catch (error) {
                showError("Fout bij opschonen van berichten: " + error.message);
            }
        }

        async function clearAllMessages() {
            if (!currentUser.isAdmin) return;

            if (!confirm("Weet je zeker dat je ALLE berichten wilt verwijderen? Deze actie kan niet ongedaan worden gemaakt.")) {
                return;
            }

            try {
                await globalMessagesDB.ref('globalMessages').remove();
                await privateMessagesDB.ref('privateMessages').remove();
                showSuccess("Alle berichten succesvol verwijderd.");
                openAdminPanel(); // Herlaad het admin-paneel
                
                // Herlaad de chat
                if (isGlobalChat) {
                    loadGlobalChat();
                } else if (isPrivateChat) {
                    loadPrivateChat();
                }
                
            } catch (error) {
                showError("Fout bij verwijderen van berichten: " + error.message);
            }
        }

        // Utility functions
        function showError(message, formType = 'login') {
            const errorDiv = document.getElementById(formType === 'register' ? 'registerErrorMessage' : 'errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';

            const successDiv = document.getElementById(formType === 'register' ? 'registerSuccessMessage' : 'successMessage');
            successDiv.style.display = 'none';
        }

        function showSuccess(message, formType = 'login') {
            const successDiv = document.getElementById(formType === 'register' ? 'registerSuccessMessage' : 'successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';

            const errorDiv = document.getElementById(formType === 'register' ? 'registerErrorMessage' : 'errorMessage');
            errorDiv.style.display = 'none';
        }

        function clearMessages() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('registerErrorMessage').style.display = 'none';
            document.getElementById('registerSuccessMessage').style.display = 'none';
        }

        function setLoading(loading, formType = 'login') {
            const btn = document.getElementById(formType === 'register' ? 'registerBtn' : 'loginBtn');
            if (loading) {
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Laden...';
            } else {
                btn.disabled = false;
                btn.innerHTML = formType === 'register'
                    ? '<i class="fas fa-user-plus"></i> Account Aanmaken'
                    : '<i class="fas fa-sign-in-alt"></i> Inloggen';
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }
    </script>
</body>
</html>
